<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Snooker Score Keeper</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1e4620 0%, #2d5a2e 50%, #1e4620 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        .container {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 2rem 1.5rem;
            width: calc(100% - 2rem);
            max-width: 28rem;
            margin: 1rem auto;
        }

        .screen {
            display: none;
            min-height: 100vh;
            padding: 1rem;
        }

        .screen.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon {
            text-align: center;
            font-size: 4.5rem;
            margin-bottom: 1.5rem;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
            line-height: 1;
        }

        h1 {
            text-align: center;
            color: #1f2937;
            font-size: clamp(1.75rem, 5vw, 2.5rem);
            margin-bottom: 2rem;
            line-height: 1.2;
        }

        h2 {
            text-align: center;
            color: #1f2937;
            font-size: clamp(1.5rem, 4vw, 1.875rem);
            margin-bottom: 2rem;
            line-height: 1.2;
        }

        h3 {
            color: #1f2937;
            font-size: clamp(1rem, 3vw, 1.125rem);
            font-weight: bold;
            margin-bottom: 0.75rem;
        }

        label {
            display: block;
            color: #374151;
            font-weight: 600;
            margin-bottom: 0.75rem;
            font-size: clamp(1rem, 3vw, 1.125rem);
        }

        input[type="number"],
        input[type="text"] {
            width: 100%;
            padding: 1.25rem;
            border: 2px solid #d1d5db;
            border-radius: 0.75rem;
            font-size: clamp(1.25rem, 4vw, 1.5rem);
            text-align: center;
            font-weight: 600;
            transition: border-color 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="text"] {
            text-align: left;
            font-size: clamp(1rem, 3vw, 1.125rem);
        }

        input:focus {
            outline: none;
            border-color: #16a34a;
        }

        .btn {
            width: 100%;
            padding: 1.25rem;
            border: none;
            border-radius: 0.75rem;
            font-size: clamp(1.125rem, 3.5vw, 1.25rem);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-primary {
            background: #15803d;
            color: white;
        }

        .btn-primary:hover {
            background: #166534;
        }

        .btn-secondary {
            background: #2563eb;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-secondary:hover {
            background: #1d4ed8;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            touch-action: manipulation;
        }

        .btn-danger:active {
            transform: scale(0.97);
        }

        .input-group {
            margin-bottom: 2rem;
        }

        .player-inputs {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 2rem;
            max-height: calc(100vh - 250px);
            overflow-y: auto;
        }

        /* Game Screen Styles */
        .game-container {
            background: linear-gradient(135deg, #1e4620 0%, #2d5a2e 50%, #1e4620 100%);
            min-height: 100vh;
            width: 100%;
            padding: 0;
        }

        .header {
            position: sticky;
            top: 0;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            width: 100%;
        }

        .header-top {
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e5e7eb;
        }

        .header-top h1 {
            font-size: clamp(1.125rem, 4vw, 1.5rem);
            margin: 0;
            text-align: left;
        }

        .current-player {
            padding: 1rem;
            background: #f0fdf4;
            border-bottom: 1px solid #e5e7eb;
        }

        .current-player-label {
            font-size: clamp(0.75rem, 2.5vw, 0.875rem);
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .current-player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .current-player-name {
            font-size: clamp(1.25rem, 5vw, 1.75rem);
            font-weight: bold;
            color: #15803d;
            flex: 1;
            word-break: break-word;
        }

        .break-score {
            text-align: right;
            flex-shrink: 0;
        }

        .break-label {
            font-size: clamp(0.75rem, 2.5vw, 0.875rem);
            color: #6b7280;
        }

        .break-value {
            font-size: clamp(1.25rem, 5vw, 1.75rem);
            font-weight: bold;
            color: #15803d;
        }

        .scoreboard {
            padding: 1rem;
            background: white;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .score-cards {
            display: flex;
            gap: 0.75rem;
            padding-bottom: 0.5rem;
            min-width: min-content;
        }

        .score-card {
            flex-shrink: 0;
            min-width: 110px;
            padding: 1rem;
            border-radius: 0.75rem;
            background: #f3f4f6;
            transition: all 0.3s;
        }

        .score-card.active {
            background: #16a34a;
            color: white;
            transform: scale(1.05);
        }

        .score-card-name {
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 0.25rem;
        }

        .score-card-score {
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: bold;
        }

        .content {
            padding: 1rem;
            padding-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .balls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 0.75rem;
            justify-items: center;
        }

        .ball-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .ball-circle {
            width: clamp(2rem, 8vw, 2.5rem);
            height: clamp(2rem, 8vw, 2.5rem);
            border-radius: 50%;
            border: 2px solid #d1d5db;
        }

        .ball-count {
            font-size: clamp(0.875rem, 3vw, 1rem);
            font-weight: bold;
            color: #374151;
        }

        .ball-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin-bottom: 1.25rem;
        }

        .ball-btn {
            padding: 1.5rem 1rem;
            border: 3px solid;
            border-radius: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            touch-action: manipulation;
            min-height: 140px;
        }

        .ball-btn:active {
            transform: scale(0.95);
        }

        .ball-btn-circle {
            width: clamp(2.5rem, 10vw, 3.5rem);
            height: clamp(2.5rem, 10vw, 3.5rem);
            border-radius: 50%;
            background: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .ball-btn-name {
            color: white;
            font-weight: bold;
            font-size: clamp(1rem, 3.5vw, 1.25rem);
            text-transform: capitalize;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .ball-btn-points {
            color: white;
            font-weight: bold;
            font-size: clamp(1.75rem, 6vw, 2.25rem);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Game Over Styles */
        .trophy-icon {
            text-align: center;
            font-size: clamp(4rem, 15vw, 6rem);
            margin-bottom: 1.5rem;
            line-height: 1;
        }

        .winner-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .winner-label {
            font-size: clamp(1.125rem, 4vw, 1.5rem);
            color: #374151;
            margin-bottom: 0.75rem;
        }

        .winner-name {
            font-size: clamp(1.75rem, 6vw, 2.5rem);
            font-weight: bold;
            color: #15803d;
            margin-bottom: 2rem;
            word-break: break-word;
        }

        .rankings {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .ranking-item {
            padding: 1.25rem;
            border-radius: 0.75rem;
            background: #f3f4f6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .ranking-item.first {
            background: #fef3c7;
            border: 2px solid #f59e0b;
        }

        .ranking-name {
            font-size: clamp(1rem, 3.5vw, 1.25rem);
            font-weight: 600;
            color: #1f2937;
            flex: 1;
            word-break: break-word;
        }

        .ranking-score {
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: bold;
            color: #15803d;
            flex-shrink: 0;
        }

        /* Smooth scrolling */
        * {
            scroll-behavior: smooth;
        }

        /* Prevent zoom on input focus (iOS) */
        @supports (-webkit-touch-callout: none) {
            input[type="text"],
            input[type="number"] {
                font-size: 16px;
            }
        }

        /* Small phone optimization */
        @media (max-width: 380px) {
            .container {
                padding: 1.5rem 1rem;
            }

            .ball-buttons {
                grid-template-columns: 1fr;
            }

            .balls-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Landscape optimization */
        @media (max-height: 600px) and (orientation: landscape) {
            .screen {
                padding: 0.5rem;
            }

            .container {
                margin: 0.5rem auto;
                padding: 1.5rem 1rem;
            }

            .icon {
                font-size: 3rem;
                margin-bottom: 1rem;
            }

            h1, h2 {
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Setup Screen -->
    <div id="setupScreen" class="screen active">
        <div class="container">
            <div class="icon">üé±</div>
            <h1>Snooker Scorer</h1>
            <div class="input-group">
                <label for="numPlayers">Number of Players</label>
                <input type="number" id="numPlayers" min="2" max="8" value="2" inputmode="numeric">
            </div>
            <button class="btn btn-primary" onclick="goToNames()">Next</button>
        </div>
    </div>

    <!-- Names Screen -->
    <div id="namesScreen" class="screen">
        <div class="container">
            <h2>Enter Player Names</h2>
            <div id="playerInputs" class="player-inputs"></div>
            <button class="btn btn-primary" onclick="startGame()">Start Game</button>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="screen">
        <div class="game-container">
            <div class="header">
                <div class="header-top">
                    <h1>Snooker Match</h1>
                    <button class="btn-danger" onclick="resetGame()">
                        <span>‚Üª</span> Reset
                    </button>
                </div>
                <div class="current-player">
                    <div class="current-player-label">Current Turn</div>
                    <div class="current-player-info">
                        <div class="current-player-name" id="currentPlayerName"></div>
                        <div class="break-score">
                            <div class="break-label">Break</div>
                            <div class="break-value" id="currentBreak">0</div>
                        </div>
                    </div>
                </div>
                <div class="scoreboard">
                    <div class="score-cards" id="scoreCards"></div>
                </div>
            </div>

            <div class="content">
                <div class="card">
                    <h3>Balls Left</h3>
                    <div class="balls-grid" id="ballsGrid"></div>
                </div>

                <div class="card">
                    <h3 id="ballSelectionTitle">Pot a Red</h3>
                    <div class="ball-buttons" id="ballButtons"></div>
                    <button class="btn btn-secondary" onclick="nextPlayer()">
                        Next Player ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="screen">
        <div class="container">
            <div class="trophy-icon">üèÜ</div>
            <h1>Game Over!</h1>
            <div class="winner-section">
                <div class="winner-label">üèÜ Winner üèÜ</div>
                <div class="winner-name" id="winnerName"></div>
            </div>
            <div class="rankings" id="rankings"></div>
            <button class="btn btn-primary" onclick="resetGame()">New Game</button>
        </div>
    </div>

    <script>
        // Game State
        let currentScreen = 'setup';
        let numPlayers = 2;
        let players = [];
        let scores = [];
        let currentPlayerIndex = 0;
        let currentBreak = 0;
        let redsPotted = false;
        let mustPotRed = true; // New flag to track if player must pot red next
        let ballsRemaining = {
            red: 15,
            yellow: 1,
            green: 1,
            brown: 1,
            blue: 1,
            pink: 1,
            black: 1
        };

        const ballPoints = {
            red: 1,
            yellow: 2,
            green: 3,
            brown: 4,
            blue: 5,
            pink: 6,
            black: 7
        };

        const ballColors = {
            red: '#DC2626',
            yellow: '#EAB308',
            green: '#16A34A',
            brown: '#92400E',
            blue: '#2563EB',
            pink: '#EC4899',
            black: '#1F2937'
        };

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            currentScreen = screenId;
        }

        function goToNames() {
            numPlayers = parseInt(document.getElementById('numPlayers').value) || 2;
            if (numPlayers < 2) numPlayers = 2;
            if (numPlayers > 8) numPlayers = 8;

            const container = document.getElementById('playerInputs');
            container.innerHTML = '';

            for (let i = 0; i < numPlayers; i++) {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label>Player ${i + 1}</label>
                    <input type="text" id="player${i}" placeholder="Player ${i + 1}" inputmode="text">
                `;
                container.appendChild(div);
            }

            showScreen('namesScreen');
            
            // Focus first input after a short delay
            setTimeout(() => {
                document.getElementById('player0')?.focus();
            }, 100);
        }

        function startGame() {
            players = [];
            for (let i = 0; i < numPlayers; i++) {
                const name = document.getElementById(`player${i}`).value.trim();
                if (!name) {
                    alert('Please enter names for all players');
                    return;
                }
                players.push(name);
            }

            scores = Array(numPlayers).fill(0);
            currentPlayerIndex = 0;
            currentBreak = 0;
            redsPotted = false;
            mustPotRed = true;
            ballsRemaining = {
                red: 15,
                yellow: 1,
                green: 1,
                brown: 1,
                blue: 1,
                pink: 1,
                black: 1
            };

            showScreen('gameScreen');
            updateGameUI();
        }

        function updateGameUI() {
            // Update current player
            document.getElementById('currentPlayerName').textContent = players[currentPlayerIndex];
            document.getElementById('currentBreak').textContent = currentBreak;

            // Update score cards
            const scoreCardsContainer = document.getElementById('scoreCards');
            scoreCardsContainer.innerHTML = '';
            players.forEach((player, index) => {
                const card = document.createElement('div');
                card.className = 'score-card' + (index === currentPlayerIndex ? ' active' : '');
                card.innerHTML = `
                    <div class="score-card-name">${player}</div>
                    <div class="score-card-score">${scores[index]}</div>
                `;
                scoreCardsContainer.appendChild(card);
            });

            // Update balls grid
            const ballsGrid = document.getElementById('ballsGrid');
            ballsGrid.innerHTML = '';
            Object.entries(ballsRemaining).forEach(([color, count]) => {
                const item = document.createElement('div');
                item.className = 'ball-item';
                item.innerHTML = `
                    <div class="ball-circle" style="background-color: ${ballColors[color]}"></div>
                    <div class="ball-count">${count}</div>
                `;
                ballsGrid.appendChild(item);
            });

            // Update available balls
            const availableBalls = getAvailableBalls();
            const ballButtons = document.getElementById('ballButtons');
            ballButtons.innerHTML = '';

            const title = document.getElementById('ballSelectionTitle');
            if (ballsRemaining.red > 0) {
                if (mustPotRed) {
                    title.textContent = 'Pot a Red';
                } else {
                    title.textContent = 'Pot Red or Any Color';
                }
            } else {
                title.textContent = 'Pot in Order';
            }

            availableBalls.forEach(color => {
                const btn = document.createElement('button');
                btn.className = 'ball-btn';
                btn.style.backgroundColor = ballColors[color];
                btn.style.borderColor = ballColors[color];
                btn.onclick = () => potBall(color);
                btn.innerHTML = `
                    <div class="ball-btn-circle"></div>
                    <div class="ball-btn-name">${color}</div>
                    <div class="ball-btn-points">${ballPoints[color]}</div>
                `;
                ballButtons.appendChild(btn);
            });
        }

        function getAvailableBalls() {
            if (ballsRemaining.red > 0) {
                if (mustPotRed) {
                    // Must pot red first
                    return ['red'];
                } else {
                    // After potting red, can pot another red or any color
                    const available = ['red'];
                    ['yellow', 'green', 'brown', 'blue', 'pink', 'black'].forEach(color => {
                        if (ballsRemaining[color] > 0) {
                            available.push(color);
                        }
                    });
                    return available;
                }
            } else {
                // All reds gone, pot colors in order
                const colorOrder = ['yellow', 'green', 'brown', 'blue', 'pink', 'black'];
                for (let color of colorOrder) {
                    if (ballsRemaining[color] > 0) {
                        return [color];
                    }
                }
                return [];
            }
        }

        function potBall(color) {
            if (ballsRemaining[color] === 0) return;

            scores[currentPlayerIndex] += ballPoints[color];
            ballsRemaining[color]--;
            currentBreak += ballPoints[color];

            if (color === 'red') {
                // After potting red, player can pot red again or any color
                mustPotRed = false;
            } else {
                // After potting a color (not red), respotted it and must pot red next
                if (ballsRemaining.red > 0) {
                    ballsRemaining[color]++;
                }
                mustPotRed = true;
            }

            const totalBalls = Object.values(ballsRemaining).reduce((a, b) => a + b, 0);
            if (totalBalls === 0) {
                showGameOver();
                return;
            }

            updateGameUI();
        }

        function nextPlayer() {
            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
            redsPotted = false;
            mustPotRed = true; // Reset: next player must start with red
            currentBreak = 0;
            updateGameUI();
        }

        function showGameOver() {
            const winnerIndex = scores.indexOf(Math.max(...scores));
            document.getElementById('winnerName').textContent = players[winnerIndex];

            const sortedPlayers = players
                .map((name, index) => ({ name, score: scores[index] }))
                .sort((a, b) => b.score - a.score);

            const rankings = document.getElementById('rankings');
            rankings.innerHTML = '';
            sortedPlayers.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = 'ranking-item' + (index === 0 ? ' first' : '');
                item.innerHTML = `
                    <div class="ranking-name">${index + 1}. ${player.name}</div>
                    <div class="ranking-score">${player.score}</div>
                `;
                rankings.appendChild(item);
            });

            showScreen('gameOverScreen');
        }

        function resetGame() {
            if (confirm('Are you sure you want to reset the game?')) {
                showScreen('setupScreen');
                document.getElementById('numPlayers').value = 2;
                numPlayers = 2;
                players = [];
                scores = [];
                currentPlayerIndex = 0;
                currentBreak = 0;
                redsPotted = false;
                mustPotRed = true;
                ballsRemaining = {
                    red: 15,
                    yellow: 1,
                    green: 1,
                    brown: 1,
                    blue: 1,
                    pink: 1,
                    black: 1
                };
            }
        }

        // Handle input blur
        document.addEventListener('DOMContentLoaded', () => {
            const numPlayersInput = document.getElementById('numPlayers');
            numPlayersInput.addEventListener('blur', (e) => {
                if (e.target.value === '' || parseInt(e.target.value) < 2) {
                    e.target.value = 2;
                }
            });
        });

        // Prevent accidental page refresh
        window.addEventListener('beforeunload', (e) => {
            if (currentScreen === 'gameScreen') {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>